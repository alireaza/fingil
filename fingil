#!/bin/bash
#Fingil written by alireza.amirsamimi@ubuntu.ir based on two scripts that written by fzero@rubi.gd 
#Fingil Version 1.00

for_function_per () {
    persian=( ض ص ث ق ف غ ع ه خ ح ج چ ش س ی ب ل ا ت ن م ک گ ظ ط ز ر ذ د پ و ۱ ۲ ۳ ۴ ۵ ۶ ۷ ۸ ۹ ۰ ! ٬ ٫ ﷼ ٪ × ، ؛ آ ژ )
    english=( q w e r t y u i o p \[ \] a s d f g h j k l \; \' z x c v b n m , 1 2 3 4 5 6 7 8 9 0 ! @ \# \$ % \^ \& \' H C )
    len=$(echo ${#english[*]})
    arg=$@
    for ((i=1 ; i < $len ; i++)) do
        arg=${arg//${persian[$i]}/${english[$i]}}
    done

    echo "$arg"
}

for_function_en () {
    persian=( ض ص ث ق ف غ ع ه خ ح ج چ ش س ی ب ل ا ت ن م ک گ ظ ط ز ر ذ د پ و ۱ ۲ ۳ ۴ ۵ ۶ ۷ ۸ ۹ ۰ ! ٬ ٫ ﷼ ٪ × ، ؛ آ ژ )
    english=( q w e r t y u i o p \[ \] a s d f g h j k l \; \' z x c v b n m , 1 2 3 4 5 6 7 8 9 0 ! @ \# \$ % \^ \& \' H C )
    english_capital=( Q W E R T Y U I O P \[ \] A S D F G H J K L \; \' Z X C V B N M , 1 2 3 4 5 6 7 8 9 0 ! @ \# \$ % \^ \& \' )
    len=$(echo ${#persian[*]})
    arg=$@
    for ((i=1 ; i < $len ; i++)) do
        arg=${arg//${english[$i]}/${persian[$i]}}
    done
    for ((i=1 ; i < $len ; i++)) do
        arg=${arg//${english_capital[$i]}/${persian[$i]}}
    done	
    echo "$arg"
}
#get active window PID
window_pid=$(xdotool getactivewindow)
#copy clipboard
clipboard=$(xclip -o -sel clip )
while [ -f /tmp/fingil.txt ];do
    sleep 0.5
done    
#send clipboard to a text file
echo $clipboard > /tmp/fingil.txt
#checking encoding of file.utf8 is for persian language.
encode_type=$(file -bi /tmp/fingil.txt)
#convert them according to the encoding

if [ "$encode_type" == "text/plain; charset=utf-8" ];then
    for_function_per $clipboard
    sleep 1
    xdotool type --delay 400 --window $window_pid "$(for_function_per $clipboard)"
else
    for_function_en  $clipboard
    sleep 1
    xdotool  type --delay 400 --window $window_pid "$(for_function_en $clipboard)"
fi
rm /tmp/fingil.txt
exit
